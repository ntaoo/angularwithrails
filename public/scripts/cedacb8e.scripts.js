(function(){"use strict";var a;a=angular.module("app",["ngCookies","ngResource","ngSanitize","ngRoute"]),a.config(["$locationProvider",function(a){return a.html5Mode(!0)}]),a.config(["$routeProvider",function(a){return a.when("/",{templateUrl:"views/main.html",controller:"MainCtrl"}).when("/sign_in",{templateUrl:"views/sign_in.html",controller:"SignInCtrl"}).when("/sign_up",{templateUrl:"views/sign_up.html",controller:"SignUpCtrl"}).when("/articles",{templateUrl:"views/articles.html",controller:"ArticlesCtrl",resolve:{checkCurrentUser:["Authentication",function(a){return a.checkCurrentUser()}]}}).otherwise({redirectTo:"/"})}]),a.config(["$httpProvider",function(a){var b;return b=["$rootScope","$location","$q",function(a,b,c){var d,e;return e=function(a){return a},d=function(b){return 401===b.status?(console.log(" catch 401"),a.$broadcast("event:signInRequired"),c.reject(b)):422===b.status?(console.log("catch 422"),c.reject(b)):c.reject(b)},function(a){return a.then(e,d)}}],a.responseInterceptors.push(b)}]),a.service("Authentication",["$rootScope","$http","$q","$location","currentUser",function(a,b,c,d,e){return{signUp:function(d,f){var g;return g=c.defer(),b.post("/api/sign_up",{sign_up:{email:d,password:f}}).success(function(b){return console.log("signed up and signed in"),e.set(b.currentUser),a.$broadcast("event:signedIn"),g.resolve()}).error(function(a,b){return 422===b?(console.log("status code: 422"),g.reject(a,b)):g.reject(a,b)}),g.promise},signIn:function(d,f){var g;return g=c.defer(),b.post("/api/sign_in",{session:{email:d,password:f}}).success(function(b){return console.log("signed in"),e.set(b.currentUser),a.$broadcast("event:signedIn"),g.resolve()}).error(function(a,b){return 422===b?(console.log("status code: 422"),g.reject(a,b)):g.reject(a,b)}),g.promise},checkCurrentUser:function(){return e.isExisting()?void 0:a.$broadcast("event:signInRequired")},clearCurrentUser:function(){return e.clear()}}}]),a.service("currentUser",["$http","$q",function(a,b){var c,d,e;return d=null,c=null,e=function(){return d=null,c=null},{isExisting:function(){return null!==d&&null!==c},signOut:function(){var c;return c=b.defer(),a["delete"]("/api/sign_out").success(function(){return e(),c.resolve()}).error(function(a,b){return 422===b?(console.log("status code: 422"),c.reject(a,b)):c.reject(a,b)})},set:function(a){return d=a.id,c=a.email},clear:function(){return e()}}}]),a.run(["$rootScope","$http","$location","Authentication",function(a,b,c,d){return a.$on("event:signInRequired",function(){return d.clearCurrentUser(),c.path("/sign_in")})}])}).call(this),function(){"use strict";angular.module("app").controller("MainCtrl",["$scope","$http","currentUser","$location",function(a,b,c,d){return b.get("/api/touch"),a.signOut=function(){return c.signOut().then(function(){return console.log("signed out"),d.path("/sign_in")},function(a){return console.log(a)})}}])}.call(this),function(){"use strict";angular.module("app").controller("SignInCtrl",["$scope","$http","$location","Authentication",function(a,b,c,d){return a.user=null,a.signIn=function(){return d.signIn(a.user.email,a.user.password).then(function(){return c.path("/")},function(a){return console.log(a)})}}])}.call(this),function(){"use strict";angular.module("app").controller("SignUpCtrl",["$scope","$http","$location","Authentication",function(a,b,c,d){return a.user=null,a.signUp=function(){return d.signUp(a.user.email,a.user.password).then(function(){return c.path("/")},function(a){return console.log(a)})}}])}.call(this),function(){"use strict";angular.module("app").controller("ArticlesCtrl",["$scope","$http",function(a,b){return b.get("/api/articles").success(function(b){return a.awesomeArticles=b.articles})}])}.call(this);